[[plugins]]
repo = 'Shougo/ddc.vim'
depends = 'denops.vim'
on_event = ['InsertEnter']

hook_add = '''
inoremap <C-n> <Cmd>call pum#map#insert_relative(+1)<CR>
inoremap <C-p> <Cmd>call pum#map#insert_relative(-1)<CR>
'''
hook_source = '''
call ddc#custom#patch_global('ui', 'pum')
call ddc#custom#patch_global('sources', [
\   'lsp',
\   'denippet',
\   'around',
\   'copilot',
\])
call ddc#custom#patch_global('sourceOptions', #{
\   _: #{
\       matchers: ['matcher_head', 'matcher_fuzzy'],
\       sorters: ['sorter_rank'],
\   },
\   lsp: #{
\       isVolatile: v:true,
\       mark: 'lsp',
\       forceCompletionPattern: '\.\w*|:\w*|->\w*',
\   },
\   denippet: #{
\       mark: 'dp',
\       dup: v:true,
\   },
\   around: #{
\       mark: 'A',
\   },
\   copilot: #{
\       mark: 'copilot',
\       matchers: [],
\       minAutoCompleteLength: 0,
\   },
\})
call ddc#custom#patch_global('sourceParams', #{
\   around: #{
\       maxSize: 50,
\   },
\   lsp: #{
\       snippetEngine: denops#callback#register({
\           body -> vsnip#anonymous(body)
\       }),
\       enableResolveItem: v:true,
\       enableAdditionalTextEdit: v:true,
\       triggerCharacters: ['.', ':'],
\   },
\   copilot: #{
\       copilot: 'vim',
\   },
\})
call ddc#custom#patch_global('autoCompleteEvents', [
\   'InsertEnter',
\   'TextChangedI',
\   'TextChangedP',
\])

call ddc#enable()
'''

[[plugins]]
repo = 'tani/ddc-fuzzy'
on_source = 'ddc.vim'

[[plugins]]
repo = 'Shougo/ddc-source-around'
on_source = 'ddc.vim'

[[plugins]]
repo = 'Shougo/ddc-ui-pum'
depends = 'pum.vim'
on_source = 'ddc.vim'

[[plugins]]
repo = 'Shougo/ddc-matcher_head'
on_source = 'ddc.vim'

[[plugins]]
repo = 'Shougo/ddc-sorter_rank'
on_source = 'ddc.vim'

[[plugins]]
repo = 'Shougo/ddc-source-lsp'
on_source = 'ddc.vim'

[[plugins]]
repo = 'neovim/nvim-lspconfig'
depends = ['ddc.vim', 'ddc-source-lsp']
on_event = ['InsertEnter']
hook_add = '''
set omnifunc=v:lua.vim.lsp.omnifunc

nnoremap <silent> <leader>d <cmd>lua vim.lsp.buf.definition()<CR>
nnoremap <silent> <leader>e <cmd>lua vim.lsp.buf.declaration()<CR>
nnoremap <silent> <leader>h <cmd>lua vim.lsp.buf.hover()<CR>
'''
hook_source = '''
lua << EOF
local capabilities = require('ddc_source_lsp').make_client_capabilities()

vim.lsp.config('pylsp', {
    capabilities = capabilities,
    settings = {
        pylsp = {
            plugins = {
                pycodestyle = {
                    enabled = false
                },
                pylint = {
                    enabled = false
                }
            }
        },
    },
})
vim.lsp.enable('pylsp')

vim.lsp.config('rust_analyzer', {
    capabilities = capabilities,
    settings = {
        ['rust-analyzer'] = {
            cargo = {
                allFeatures = true,
            },
            checkOnSave = true,
            inlayHints = {
                bindingModeHints = {
                    enable = true,
                },
                genericParameterHints = {
                    type = {
                        enable = true,
                    },
                },
            },
        },
    },
})
vim.lsp.enable('rust_analyzer')

vim.lsp.config('csharp_ls', {
    capabilities = capabilities,
    settings = {
    },
})
vim.lsp.enable('csharp_ls')

vim.lsp.inlay_hint.enable(true)

vim.lsp.handlers["textDocument/hover"] = vim.lsp.with(vim.lsp.handlers.hover, {
    border = "none",
})
EOF
'''

[[plugins]]
repo = 'uga-rosa/ddc-source-lsp-setup'
on_source = ['ddc.vim']
hook_source = '''
lua << EOF
require('ddc_source_lsp_setup').setup()
EOF
'''

[[plugins]]
repo = 'uga-rosa/denippet.vim'
on_source = ['ddc.vim', 'denops.vim']
hook_source = '''
let dir = stdpath('config') . '/snippet/'
for file in glob(dir . '*.*', 1, 1)
    call denippet#load(file)
endfor

inoremap <C-k> <Plug>(denippet-expand)
inoremap <expr> <Tab> denippet#jumpable() ? '<Plug>(denippet-jump-next)' : '<Tab>'
snoremap <expr> <Tab> denippet#jumpable() ? '<Plug>(denippet-jump-next)' : '<Tab>'
inoremap <expr> <S-Tab> denippet#jumpable(-1) ? '<Plug>(denippet-jump-next-prev)' : '<Tab>'
snoremap <expr> <S-Tab> denippet#jumpable(-1) ? '<Plug>(denippet-jump-next-prev)' : '<Tab>'
'''

[[plugins]]
repo = 'github/copilot.vim'

[[plugins]]
repo = 'Shougo/ddc-source-copilot'
on_source = ['copilot.vim', 'denops.vim', 'ddc.vim']
hook_source = '''
lua << EOF
vim.g.copilot_enabled = false
vim.g.coliplot_no_maps = true
EOF
'''
